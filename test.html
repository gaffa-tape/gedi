<!DOCTYPE html>
<html>
    <head>
        <style>
            h1{
                margin:0;
                font-size:1.5em;
            }
            .passed h1{
                color: #0A0;
            }
            .failed h1{
                color: #A00;
            }     
            .test .description{
                height:0px;
                overflow:scroll;
                -webkit-transition:height 0.2s linear;
                -moz-transition:height 0.2s linear;
                -ms-transition:height 0.2s linear;
                transition:height 0.2s linear;
            }
            .test:hover .description{
                height:200px;            
            }
        </style>
        <script src="https://raw.github.com/KoryNunn/crel/master/crel.js"></script>
        <script src="gel/gel.js"></script>
        <script src="gedi.js"></script>
        <script>
        window.onload = function(){

            var tests = [
                {
                    name: "basic get",
                    test: function(){
                        var gediTest = new gedi({thing:'stuff'});
                        
                        this.result = gediTest.get('[thing]');
                    },
                    expected: 'stuff'
                },
                {
                    name: "nested get",
                    test: function(){
                        var gediTest = new gedi({thing:{stuff:{majigger:'stuff'}}});
                        
                        this.result = gediTest.get('[thing/stuff/majigger]');
                    },
                    expected: 'stuff'
                },
                {
                    name: "basic set",
                    test: function(){
                        var gediTest = new gedi();
                        
                        gediTest.set('[thing]', 'stuff');
                        this.result = gediTest.get('[thing]');
                    },
                    expected: 'stuff'
                },
                {
                    name: "nested set",
                    test: function(){
                        var gediTest = new gedi({thing:{stuff:{majigger:'stuff'}}});
                        
                        gediTest.set('[thing/stuff/majigger]', 'things');
                        this.result = gediTest.get('[thing/stuff/majigger]');
                    },
                    expected: 'things'
                },
                {
                    name: "basic remove",
                    test: function(){
                        var gediTest = new gedi({thing:'stuff'});
                        
                        gediTest.remove('[thing]');
                        this.result = gediTest.get('[thing]');
                    },
                    expected: undefined
                },
                {
                    name: "nested remove",
                    test: function(){
                        var gediTest = new gedi({thing:{stuff:{majigger:'stuff'}}});
                        
                        gediTest.remove('[thing/stuff/majigger]');
                        this.result = gediTest.get('[thing/stuff/majigger]');
                    },
                    expected: undefined
                },
                {
                    name: "tree creation",
                    test: function(){
                        var gediTest = new gedi();
                        
                        gediTest.set('[thing/stuff/majigger]', 'things');
                        this.result = gediTest.get('[thing/stuff/majigger]');
                    },
                    expected: 'things'
                },
                {
                    name: "basic bind",
                    test: function(){
                        var gediTest = new gedi(),
                            test = this;
                        
                        gediTest.set('[thing]', 'things');
                        gediTest.bind('[thing]', function(){
                            test.result = true;
                        });
                        gediTest.set('[thing]', 'stuff');
                    },
                    expected: true
                },
                {
                    name: "nested bind",
                    test: function(){
                        var gediTest = new gedi(),
                            test = this;
                        
                        gediTest.set('[thing/stuff/majigger]', 'things');
                        gediTest.bind('[thing/stuff/majigger]', function(){
                            test.result = true;
                        });
                        gediTest.set('[thing/stuff/majigger]', 'stuff');
                    },
                    expected: true
                },
                {
                    name: "pre allocated bind",
                    test: function(){
                        var gediTest = new gedi(),
                            test = this;
                        
                        gediTest.bind('[thing/stuff/majigger]', function(){
                            test.result = true;
                        });
                        gediTest.set('[thing/stuff/majigger]', 'stuff');
                    },
                    expected: true
                },
                {
                    name: "relative get",
                    test: function(){
                        var gediTest = new gedi({thing:{stuff:{majigger:'stuff'}}}),
                            test = this;
                        
                        this.result = gediTest.get('[majigger]', '[thing/stuff]');
                    },
                    expected: 'stuff'
                },
                {
                    name: "relative set",
                    test: function(){
                        var gediTest = new gedi(),
                            test = this;
                        
                        gediTest.set('[majigger]', 'whatsit', '[thing/stuff]');
                        this.result = gediTest.get('[thing/stuff/majigger]');
                    },
                    expected: 'whatsit'
                },
                {
                    name: "up a level get",
                    test: function(){
                        var gediTest = new gedi({thing:{stuff:{majigger:'stuff'}, whatsits:'things'}}),
                            test = this;
                        
                        this.result = gediTest.get('[../whatsits]', '[thing/stuff]');
                    },
                    expected: 'things'
                },
                {
                    name: "up a level set",
                    test: function(){
                        var gediTest = new gedi(),
                            test = this;
                        
                        gediTest.set('[../whatsit]', 'whatsit', '[thing/stuff]');
                        this.result = gediTest.get('[/thing/whatsit]');
                    },
                    expected: 'whatsit'
                },
                {
                    name: "root get",
                    test: function(){
                        var gediTest = new gedi({thing:{stuff:{majigger:'stuff'}, whatsits:'hello'}}),
                            test = this;
                        
                        this.result = gediTest.get('[/thing/whatsits]', '[thing/stuff]');
                    },
                    expected: 'hello'
                },
                {
                    name: "root set",
                    test: function(){
                        var gediTest = new gedi(),
                            test = this;
                        
                        gediTest.set('[thing/stuff/majigger]', 'stuff');
                        gediTest.set('[/thing/whatsits]', 'hello', '[thing/stuff/majigger]');
                        
                        this.result = gediTest.get('[/thing/whatsits]');
                    },
                    expected: 'hello'
                },
                {
                    name: "same path get",
                    test: function(){
                        var gediTest = new gedi({thing:{stuff:{majigger:'stuff'}}}),
                            test = this;
                        
                        this.result = gediTest.get('[]', '[thing/stuff/majigger]');
                    },
                    expected: 'stuff'
                },
                {
                    name: "same path set",
                    test: function(){
                        var gediTest = new gedi(),
                            test = this;
                        
                        gediTest.set('[]', 'stuff', '[thing/stuff/majigger]');
                        
                        this.result = gediTest.get('[thing/stuff/majigger]');
                    },
                    expected: 'stuff'
                },
                {
                    name: "set clean",
                    test: function(){
                        var gediTest = new gedi(),
                            test = this;
                        
                        gediTest.set('[thing/stuff/majigger]', 'stuff', null, false);
                        this.result = gediTest.isDirty('[thing/stuff/majigger]');
                    },
                    expected: false
                },
                {
                    name: "set implicit dirty",
                    test: function(){
                        var gediTest = new gedi(),
                            test = this;
                        
                        gediTest.set('[thing/stuff/majigger]', 'stuff');
                        this.result = gediTest.isDirty('[thing/stuff/majigger]');
                    },
                    expected: true
                },
                {
                    name: "set explicit dirty",
                    test: function(){
                        var gediTest = new gedi(),
                            test = this;
                        
                        gediTest.set('[thing/stuff/majigger]', 'stuff', null, true);
                        this.result = gediTest.isDirty('[thing/stuff/majigger]');
                    },
                    expected: true
                },
                {
                    name: "set root (overwrite model)",
                    test: function(){
                        var gediTest = new gedi(),
                            test = this;
                        
                        gediTest.set({things:'stuff'});
                        this.result = gediTest.get('[things]');
                    },
                    expected: 'stuff'
                },
                {
                    name: "get root (return model)",
                    test: function(){
                        var gediTest = new gedi('stuff'),
                            test = this;
                        
                        this.result = gediTest.get();
                    },
                    expected: 'stuff'
                },
                {
                    name: "get dirty state of overwrite",
                    test: function(){
                        var gediTest = new gedi(),
                            test = this;
                        
                        gediTest.set({things:'stuff'});
                        this.result = gediTest.isDirty();
                    },
                    expected: true
                },
                {
                    name: "set dirty state of overwrite",
                    test: function(){
                        var gediTest = new gedi(),
                            test = this;
                        
                        gediTest.set({things:'stuff'}, false);
                        this.result = gediTest.isDirty();
                    },
                    expected: false
                },
                {
                name: "expression path resolving",
                    test: function(){
                        var gediTest = new gedi({stuff:{things:[1,2,3]}}),
                            test = this;
                        
                        
                        this.result = gediTest.get('(last [things])', '[stuff]');
                    },
                    expected: 3
                },
                {
                name: "expression root path resolving",
                    test: function(){
                        var gediTest = new gedi({stuff:{things:[1,2,3]}}),
                            test = this;
                        
                        
                        this.result = gediTest.get('(length [/stuff].things)', '[stuff]');
                    },
                    expected: 3
                }
            ];
            
            var resultsElement = document.getElementsByClassName('results')[0];

            function runTests(){
                for(var i = 0; i < tests.length; i++){
                    var test = tests[i],
                        resultElement,
                        title,
                        result,
                        description;
                    
                    test.test.call(test);
                    test.passed = test.result === test.expected;
                    
                    resultElement = crel('div', {'class':(test.passed && 'passed' || 'failed') + ' test'},
                        (title = crel('h1', test.name + ' ' + (test.passed && 'passed' || 'failed'))),
                        (result = crel('span', {'class':'result'}), 'output: ' + test.result + ', expected: ' + test.expected),
                        (description = crel('pre', {'class':'description'}, test.test.toString()))
                    );
                    
                    resultsElement.appendChild(resultElement);
                }
            }
            
            runTests();
        
        };

        </script>
    </head>
    <body>
        <div class="results"></div>
    </body>
</html>